# Feature Request: User Management CRUD (MVP)

## 📋 Feature Description

Create a minimal, production-oriented User Management CRUD suitable for an internal corporate environment. Implementation must be a clear, modular NestJS module that includes Prisma schema, DTOs, service, controller, and basic tests. Prioritize speed of delivery (MVP), maintainability, and basic security.

## 🎯 Feature Type

- [x] 🚀 **New API Endpoint** - New REST API functionality
- [x] 📊 **Database/Model** - New entity and Prisma migration
- [x] 🔐 **Authentication/Authorization (prep)** - Prepare for JWT integration (not implement auth now)
- [ ] 🔧 **Configuration**
- [ ] 📧 **Notification/Email**
- [ ] 🛡️ **Security**
- [ ] ⚡ **Performance**
- [ ] 🔌 **Integration**
- [ ] 📱 **API Enhancement**
- [ ] 🎨 **Developer Experience**

## 💡 Problem Statement

Current codebase lacks a standardized, secure, and testable User entity and API to manage users. Teams need a small, well-documented module to onboard authentication later and to support internal admin operations.

### Current Situation

- No user CRUD endpoints or Prisma model are present in the project.
- No DTOs, services or controllers for user management are available.
- No tests covering user lifecycle (create/read/update/delete).

### Proposed Solution

Implement a self-contained NestJS `users` module with:

- Prisma `User` model and a single migration.
- DTOs for create and update operations with validation (class-validator).
- UsersService with hashed password creation (bcrypt), read, update, soft-delete.
- UsersController exposing REST endpoints (POST /users, GET /users, GET /users/:id, PATCH /users/:id, DELETE /users/:id).
- Unit tests for service and e2e test for controller happy path.
- Clear README snippet and swagger decorators for API discovery.

## 🎨 Feature Requirements

### Functional Requirements

- [ ] Create user with hashed password (bcrypt) and required fields: name, email, password.
- [ ] List active users (isActive = true).
- [ ] Get user by id (404 if not found).
- [ ] Update user (partial updates allowed).
- [ ] Soft-delete user (mark isActive = false).
- [ ] Exclude password from API responses.

### Non-Functional Requirements

- [ ] Follow NestJS module pattern (controller, service, module, dto, entities).
- [ ] Use Prisma as ORM and PostgreSQL-compatible schema.
- [ ] Validation with class-validator / class-transformer.
- [ ] Minimum unit test coverage for the users service (target 80% on changed code).
- [ ] Code formatted and linted according to repository rules.

## 📐 Technical Specifications

### API Design

Endpoints (REST):

- POST /api/v1/users
  - Request (JSON): { "name": "string", "email": "string", "password": "string" }
  - Response (201): { "id": number, "name": "string", "email": "string", "role": "string", "isActive": true, "createdAt": "iso" }

- GET /api/v1/users
  - Response (200): { "data": [ { user }, ... ] }

- GET /api/v1/users/:id
  - Response (200): { user }
  - 404 if not found

- PATCH /api/v1/users/:id
  - Request: partial { name?, email?, password? }
  - Response (200): updated user

- DELETE /api/v1/users/:id
  - Soft-delete: sets isActive = false
  - Response (204) or (200) with updated resource

Include Swagger decorators and DTO validation for request contracts.

### Database Changes

Prisma model (add to prisma/schema.prisma):

```prisma
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String   @default("user")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

Generate one migration using the Prisma CLI. Migration name should include the branch/feature identifier when created by feature branch rules.

### Dependencies

- prisma, @prisma/client
- bcrypt (or bcryptjs)
- class-validator, class-transformer
- @nestjs/swagger (optional but recommended)

## 🧪 Acceptance Criteria

### Core Functionality

- [ ] POST creates a user and stores hashed password.
- [ ] GET list returns only active users and does not include `password`.
- [ ] GET by id returns user or 404.
- [ ] PATCH updates allowed fields.
- [ ] DELETE sets `isActive` to false.

### Quality Assurance

- [ ] Unit tests for UsersService (happy path + not-found case).
- [ ] E2E test covering creation -> retrieval -> update -> soft-delete flow.
- [ ] Lint and format checks pass.

### Security & Performance

- [ ] Passwords hashed using bcrypt with salt rounds = 10 (configurable).
- [ ] No sensitive fields in responses.

## 📸 Mockups / Examples

Create user example request:

```json
POST /api/v1/users
{
  "name": "Alice Smith",
  "email": "alice@example.com",
  "password": "s3cretpw"
}
```

Expected create response (201):

```json
{
  "id": 1,
  "name": "Alice Smith",
  "email": "alice@example.com",
  "role": "user",
  "isActive": true,
  "createdAt": "2025-10-07T12:00:00.000Z"
}
```

## 🔗 Related Issues

- Depends on: none
- Related to: future auth feature (JWT) — track as separate ticket

## 🚀 Implementation Notes

### Development Approach

1. Generate NestJS schematic: `nest g module users`, `nest g service users`, `nest g controller users`.
2. Add Prisma model and run `pnpm db:migrate` (or `prisma migrate dev`) to create migration.
3. Implement DTOs with `class-validator` and map to Prisma inputs.
4. Implement UsersService with bcrypt hashing and Prisma operations.
5. Implement controller endpoints and Swagger decorators.
6. Add unit tests and a short e2e test.

### Technical Considerations

- Always exclude `password` from outgoing responses by selecting fields in Prisma queries or mapping results.
- Use soft-delete strategy (isActive) instead of physical delete.
- Keep password hashing and salt rounds configurable via environment variables.

### Breaking Changes

- [ ] No breaking changes expected — adding a new module and database table.

## 🎯 Priority

- [ ] 🔴 **Critical**
- [x] 🟡 **High** - Important for next release (MVP)
- [ ] 🟢 **Medium**
- [ ] 🔵 **Low**

## 📅 Timeline

- **Target Release**: next sprint (MVP)
- **Estimated Effort**: 2-4 working days
- **Dependencies**: Database access for migrations and a development DB

## 📝 Additional Context

### Research

- Prisma for schema and migrations; NestJS module conventions; bcrypt for hashing.

### Alternatives Considered

- Use TypeORM instead of Prisma (not recommended for this repo MVP).
- Store hashed password and implement access control later via JWT.

---

**Prepared for Copilot implementation** — all inputs/outputs and acceptance tests are specified to allow straightforward code generation and automated tests.
